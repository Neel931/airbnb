<% layout('/layouts/boilerplate') -%>

<div class="row mt-3">
  <div class="col-8 offset-3">
    <h3>Listing in detail:</h3>
  </div>
  <div class="card col-6 offset-3 show-card listing-card">
    <img
      src="<%=listing.image.url%>"
      class="card-img-top show-img"
      alt="listing image"
    />
    

    <div class="card-body">
      <p class="card-text">
        <i><%=  listing.owner.username%></i><br></p>
         <p class="card-text">
        <b><%=listing.title%></b><br /></p>
         <p class="card-text"><%=listing.description%><br /></p>
        <p class="card-text">
        &#8377;<%=listing.price.toLocaleString('en-IN')%><br /></p>
        <p class="card-text">
        <%=listing.location%><br /></p>
        <p class="card-text"> <%=listing.country%><br /></p>
      </p>
    </div>
  </div>
  <br />
  <% if (currentUser && currentUser._id.equals(listing.owner._id)) { %>
   

  <div class="btns">
    <a href="/listings/<%=listing._id%>/edit" class="btn btn-dark col-1 offset-3 edit-btn">Edit</a>

    <form method="post" action="/listings/<%= listing._id %>?_method=DELETE">
      <button class="btn btn-dark offset-3">Delete</button>
    </form>
  </div>
    <% } %>
</div>



  

<div class="col-8 offset-3 mb-3">
  <hr />
  <% if (currentUser) {%>
  <h4>Leave a review</h4>

  <form 
    action="/listings/<%= listing._id %>/reviews" 
    method="POST" 
    novalidate 
    class="needs-validation"
  >

    <!-- RATING -->
    <div class="mb-3 mt-3">
      <label for="rating" class="form-label">Rating</label>
      <input
        type="range"
        class="form-range"
        name="review[rating]"
        id="rating"
        min="1"
        max="5"
        required
      />
      <div class="invalid-feedback">
        Please provide a rating between 1 and 5.
      </div>
    </div>
    <!-- THis is comment on storing message connect flash  -->

    <!-- COMMENT -->
    <div class="mb-3 mt-3">
      <label for="comment" class="form-label">Comments</label>
      <textarea
        class="form-control"
        name="review[comment]"
        id="comment"
        cols="30"
        rows="5"
        required
      ></textarea>
      <div class="invalid-feedback">
        Please submit some comments for review.
      </div>
    </div>

    <button class="btn btn-outline-dark">
      Submit
    </button>

  </form>
  <% } %>
  <p>All reviews:</p>
  <div class="row">
 
  <% for(review of listing.reviews){ %>
   <div class="card col-5 ms-3 mb-3">
    <div class="card-body">
      <h5>@<%= review.author.username%></h5>
      <p class="card-tex"><%=review.comment%></p>
      <p class="card-tex"><%=review.rating%> start</p>
    </div>
   <form 
  action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE"
  method="POST"
>
  <button class="btn btn-sm btn-dark">
    Delete
   
  </button>
</form>

   </div>
    <% } %>
    </div>
</div>
